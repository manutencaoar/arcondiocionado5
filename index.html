<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>ManutenÃ§Ã£o de Ar-Condicionado</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<style>
body{font-family:Arial,sans-serif;background:#f7f9fb;padding:20px;text-align:center;}
.card{background:#fff;padding:20px;border-radius:8px;max-width:500px;margin:auto;box-shadow:0 4px 8px rgba(0,0,0,.1);}
input,textarea,button,select{width:100%;padding:10px;margin-top:10px;font-size:16px;}
button{background:#1976d2;color:#fff;border:none;border-radius:6px;cursor:pointer;}
.hidden{display:none;}
.list{background:#eef2f7;padding:10px;margin-top:10px;border-radius:6px;text-align:left;}
.logout{background:#d32f2f;margin-top:15px;}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

<!-- LOGIN -->
<div class="card" id="loginCard">
  <h2>ğŸ”§ Login TÃ©cnico</h2>
  <input id="loginEmail" placeholder="Email">
  <input id="loginPass" type="password" placeholder="Senha">
  <button onclick="loginTecnico()">Entrar</button>
  <button onclick="showRegister()">Cadastrar TÃ©cnico</button>
</div>

<!-- REGISTER -->
<div class="card hidden" id="registerCard">
  <h2>ğŸ†• Cadastrar TÃ©cnico</h2>
  <input id="regEmail" placeholder="Email">
  <input id="regPass" type="password" placeholder="Senha">
  <button onclick="registerTecnico()">Cadastrar</button>
  <button class="logout" onclick="backToLogin()">Voltar</button>
</div>

<!-- ADMIN -->
<div class="card hidden" id="adminCard">
  <h3>ğŸ”§ Painel TÃ©cnico</h3>

  <h4>â• Cadastrar Cliente & Aparelho</h4>
  <input id="clienteNome" placeholder="Nome do Cliente">
  <input id="aparelhoDesc" placeholder="DescriÃ§Ã£o (modelo/BTUs/local)">
  <button onclick="addAparelho()">Salvar Aparelho</button>

  <hr>

  <h4>ğŸ“Š Seus Aparelhos</h4>
  <div id="listaAparelhos"></div>

  <button class="logout" onclick="logoutTecnico()">Sair</button>
</div>

<!-- CLIENTE -->
<div class="card hidden" id="clienteCard">
  <h3>ğŸ‘¤ HistÃ³rico do Aparelho</h3>
  <div id="clienteHistorico"></div>
</div>

<script>

// ===== FIREBASE CONFIG =====
// â— Substitua pelas suas configuraÃ§Ãµes
const firebaseConfig = {
  apiKey: "SEU_API_KEY",
  authDomain: "SEU_AUTH_DOMAIN",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_STORAGE_BUCKET",
  messagingSenderId: "SEU_SENDER_ID",
  appId: "SEU_APP_ID"
};
// ============================

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ------------------ LOGIN / REGISTER ------------------
function showRegister(){
  document.getElementById("loginCard").classList.add("hidden");
  document.getElementById("registerCard").classList.remove("hidden");
}
function backToLogin(){
  document.getElementById("registerCard").classList.add("hidden");
  document.getElementById("loginCard").classList.remove("hidden");
}

function registerTecnico(){
  const email = regEmail.value;
  const pass = regPass.value;
  auth.createUserWithEmailAndPassword(email, pass)
    .then(()=> alert("TÃ©cnico cadastrado com sucesso!"))
    .catch(e => alert("Erro: "+e.message));
}

function loginTecnico(){
  const email = loginEmail.value;
  const pass = loginPass.value;
  auth.signInWithEmailAndPassword(email, pass)
    .then(() => loadAdmin())
    .catch(e => alert("Erro: "+e.message));
}

function logoutTecnico(){
  auth.signOut();
  location.reload();
}

// ------------------ ADMIN FUNCTIONS ------------------
function loadAdmin(){
  document.getElementById("loginCard").classList.add("hidden");
  document.getElementById("adminCard").classList.remove("hidden");
  listarAparelhos();
}

function addAparelho(){
  const cliente = clienteNome.value.trim();
  const desc = aparelhoDesc.value.trim();
  if(!cliente || !desc) return alert("Preencha tudo!");

  db.collection("aparelhos").add({
    cliente,
    desc,
    criado: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    clienteNome.value="";
    aparelhoDesc.value="";
    listarAparelhos();
  });
}

function listarAparelhos(){
  listaAparelhos.innerHTML="";
  db.collection("aparelhos").orderBy("criado", "desc")
    .get().then(snapshot => {
      snapshot.forEach(doc => {
        const d = doc.data();
        const id = doc.id;
        listaAparelhos.innerHTML += `
          <div class="list">
            <strong>${d.cliente}</strong><br>${d.desc}<br>
            <a href="?id=${id}" target="_blank">Ver Como Cliente</a>
            <button onclick="gerarQR('${id}')">ğŸ“Œ QR</button>
            <button onclick="excluirAparelho('${id}')">ğŸ—‘ï¸ Excluir</button>
          </div>`;
      });
    });
}

function excluirAparelho(id){
  db.collection("aparelhos").doc(id).delete().then(() => listarAparelhos());
}

function gerarQR(id){
  const url = `${location.origin}${location.pathname}?id=${id}`;
  const qr = "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data="+encodeURIComponent(url);
  window.open(qr, "_blank");
}

// ------------------ CLIENT VIEW ------------------
window.onload = function(){
  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  if(id){
    document.getElementById("loginCard").classList.add("hidden");
    document.getElementById("adminCard").classList.add("hidden");
    document.getElementById("clienteCard").classList.remove("hidden");
    listarHistorico(id);
  }
};

function listarHistorico(id){
  clienteHistorico.innerHTML="";
  db.collection("aparelhos").doc(id)
    .get().then(doc => {
      if(!doc.exists) return;
      const data = doc.data();
      clienteHistorico.innerHTML += `<strong>${data.cliente}</strong><br>${data.desc}<hr>`;
      db.collection("aparelhos").doc(id)
        .collection("manutencoes").orderBy("data", "desc")
        .get().then(snap => {
          snap.forEach(m => {
            const mt = m.data();
            clienteHistorico.innerHTML += `ğŸ“… ${mt.data}<br>${mt.descricao}<br><hr>`;
          });
        });
    });
}

// ------------------ REGISTER MANUTENCAO FROM ADMIN ------------------
function registrarManut(id){
  const desc = prompt("DescriÃ§Ã£o da manutenÃ§Ã£o:");
  if(!desc) return;
  const hoje = new Date().toLocaleDateString();
  db.collection("aparelhos").doc(id)
    .collection("manutencoes").add({data:hoje, descricao:desc})
    .then(()=> alert("ManutenÃ§Ã£o registrada!"))
    .then(() => listarAparelhos());
}

</script>

</body>
</html>
