<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGM Pro - Ar Condicionado</title>
    <style>
        :root {
            --primary: #0284c7;
            --secondary: #64748b;
            --success: #16a34a;
            --danger: #dc2626;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* Navega√ß√£o e Login */
        nav { display: flex; gap: 10px; margin-bottom: 20px; }
        nav button { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; background: var(--secondary); color: white; transition: 0.3s; }
        nav button.active { background: var(--primary); box-shadow: 0 4px 12px rgba(2, 132, 199, 0.3); }

        .panel { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); display: none; }
        .panel.active { display: block; }

        /* Formul√°rios */
        .grid-form { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        .full { grid-column: span 2; }
        
        button.action { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 6px; width: 100%; cursor: pointer; font-weight: bold; margin-top: 10px; }
        button.logout { background: #f1f5f9; color: var(--danger); border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; float: right; }

        /* Cards */
        .card { border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fff; }
        .card h4 { margin: 0 0 8px 0; display: flex; justify-content: space-between; }
        .price-tag { color: var(--success); font-weight: bold; }
        .next-maint { font-size: 12px; color: #b45309; background: #fffbeb; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-top: 5px; }
        
        .history-item { font-size: 13px; border-left: 3px solid #e2e8f0; padding-left: 10px; margin: 8px 0; }
        .history-item b { color: var(--primary); }

        #loginSection { text-align: center; padding: 40px 20px; }
    </style>
</head>
<body>

<div class="container">
    <nav>
        <button id="btn-cliente" class="active" onclick="switchPanel('cliente')">√Årea do Cliente</button>
        <button id="btn-tecnico" onclick="showLogin()">Painel T√©cnico</button>
    </nav>

    <div id="cliente" class="panel active">
        <h2>Consultar Equipamento</h2>
        <input type="text" id="buscaCliente" placeholder="üîç Digite seu nome para buscar..." onkeyup="buscarCliente()">
        <div id="resultadoBusca" style="margin-top:20px"></div>
    </div>

    <div id="loginPanel" class="panel">
        <div id="loginSection">
            <h3>Acesso Restrito</h3>
            <p>Digite a senha para gerenciar clientes.</p>
            <input type="password" id="senhaInput" placeholder="Senha do t√©cnico" style="max-width: 250px; margin-bottom: 10px;">
            <button class="action" onclick="validarSenha()" style="max-width: 250px;">Entrar</button>
        </div>
    </div>

    <div id="tecnico" class="panel">
        <button class="logout" onclick="logout()">Sair [X]</button>
        <h2>Gerenciar Manuten√ß√µes</h2>
        
        <div class="grid-form">
            <input type="text" id="nomeCliente" placeholder="Nome do Cliente" class="full">
            <input type="text" id="modelo" placeholder="Modelo do Ar">
            <input type="text" id="btus" placeholder="BTUs">
            <button class="action full" onclick="cadastrarEquipamento()">Cadastrar Novo Equipamento</button>
        </div>

        <hr>
        <h3>Equipamentos Ativos</h3>
        <div id="listaTecnico"></div>
    </div>
</div>

<script>
    // Configura√ß√µes
    const SENHA_MESTRA = "1234";
    let db = JSON.parse(localStorage.getItem('sgm_v2')) || [];

    // --- CONTROLE DE NAVEGA√á√ÉO ---
    function switchPanel(panelId) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        
        document.getElementById(panelId).classList.add('active');
        document.getElementById('btn-' + panelId).classList.add('active');
        
        if(panelId === 'tecnico') listarTecnico();
    }

    function showLogin() {
        if(sessionStorage.getItem('logado') === 'true') {
            switchPanel('tecnico');
        } else {
            switchPanel('loginPanel');
        }
    }

    function validarSenha() {
        const pass = document.getElementById('senhaInput').value;
        if(pass === SENHA_MESTRA) {
            sessionStorage.setItem('logado', 'true');
            document.getElementById('senhaInput').value = '';
            switchPanel('tecnico');
        } else {
            alert("Senha incorreta!");
        }
    }

    function logout() {
        sessionStorage.removeItem('logado');
        switchPanel('cliente');
    }

    // --- L√ìGICA DO T√âCNICO ---
    function cadastrarEquipamento() {
        const cliente = document.getElementById('nomeCliente').value.trim();
        const modelo = document.getElementById('modelo').value.trim();
        const btus = document.getElementById('btus').value.trim();

        if(!cliente || !modelo) return alert("Preencha os campos obrigat√≥rios.");

        const novo = {
            id: Date.now(),
            cliente, modelo, btus,
            historico: []
        };

        db.push(novo);
        salvar();
        listarTecnico();
        document.querySelectorAll('#tecnico input').forEach(i => i.value = '');
    }

    function adicionarServico(id) {
        const desc = prompt("Descri√ß√£o do servi√ßo realizado:");
        if(!desc) return;
        const valor = prompt("Valor do servi√ßo (R$):", "0,00");
        const meses = prompt("Pr√≥xima manuten√ß√£o em quantos meses?", "6");

        const index = db.findIndex(item => item.id === id);
        
        // Calcular data da pr√≥xima manuten√ß√£o
        const hoje = new Date();
        const proxima = new Date(hoje.setMonth(hoje.getMonth() + parseInt(meses)));
        
        const registro = {
            data: new Date().toLocaleDateString('pt-BR'),
            servico: desc,
            valor: valor,
            proxima: proxima.toLocaleDateString('pt-BR')
        };

        db[index].historico.unshift(registro);
        salvar();
        listarTecnico();
    }

    function excluir(id) {
        if(confirm("Excluir este equipamento?")) {
            db = db.filter(i => i.id !== id);
            salvar();
            listarTecnico();
        }
    }

    function salvar() { localStorage.setItem('sgm_v2', JSON.stringify(db)); }

    function listarTecnico() {
        const lista = document.getElementById('listaTecnico');
        lista.innerHTML = db.length === 0 ? '<p>Nenhum aparelho cadastrado.</p>' : '';

        db.forEach(item => {
            const ultima = item.historico[0];
            lista.innerHTML += `
                <div class="card">
                    <h4>${item.cliente} <span class="price-tag">${item.btus} BTUs</span></h4>
                    <p style="margin:5px 0">üì¶ <b>${item.modelo}</b></p>
                    ${ultima ? `<div class="next-maint">üìÖ Pr√≥xima Manuten√ß√£o: ${ultima.proxima}</div>` : ''}
                    <div style="margin-top:10px">
                        <button onclick="adicionarServico(${item.id})">‚öôÔ∏è Registrar Servi√ßo</button>
                        <button onclick="excluir(${item.id})" style="background:none; border:none; color:var(--danger); cursor:pointer">Remover</button>
                    </div>
                    <div class="hist-list">
                        ${item.historico.map(h => `
                            <div class="history-item">
                                <b>${h.data}</b> - ${h.servico} <br>
                                <small>Valor: R$ ${h.valor} | Prev: ${h.proxima}</small>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        });
    }

    // --- L√ìGICA DO CLIENTE ---
    function buscarCliente() {
        const termo = document.getElementById('buscaCliente').value.toLowerCase();
        const res = document.getElementById('resultadoBusca');
        if(termo.length < 3) { res.innerHTML = ''; return; }

        const filtrados = db.filter(i => i.cliente.toLowerCase().includes(termo));
        
        res.innerHTML = filtrados.length === 0 ? '<p>Nenhum registro encontrado.</p>' : 
            filtrados.map(item => `
                <div class="card">
                    <h3>${item.modelo} (${item.btus} BTUs)</h3>
                    <p><b>Propriet√°rio:</b> ${item.cliente}</p>
                    <hr>
                    <strong>Hist√≥rico de Manuten√ß√µes:</strong>
                    ${item.historico.map(h => `
                        <div class="history-item">
                            <b>Data: ${h.data}</b><br>
                            Servi√ßo: ${h.servico}<br>
                            <span style="color:var(--primary)">Pr√≥xima revis√£o sugerida: ${h.proxima}</span>
                        </div>
                    `).join('') || '<p>Nenhum servi√ßo registrado.</p>'}
                </div>
            `).join('');
    }
</script>

</body>
</html>
