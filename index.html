<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Manuten√ß√£o Ar-Condicionado</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: var(--text); padding: 20px; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; background: var(--card); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        
        .hidden { display: none; }
        
        h2 { color: var(--primary); border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
        
        input, button, textarea { 
            display: block; width: 100%; margin: 10px 0; padding: 12px; 
            border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 1rem;
        }

        button { 
            background-color: var(--primary); color: white; border: none; 
            cursor: pointer; font-weight: 600; transition: opacity 0.2s; 
        }
        
        button:hover { opacity: 0.9; }
        button.secondary { background-color: #64748b; margin-top: 20px; }

        .aparelho-card { 
            border-left: 5px solid var(--primary); background: #f1f5f9; 
            padding: 15px; margin: 15px 0; border-radius: 4px; 
        }

        .manutencao-item { font-size: 0.9rem; padding: 5px 0; border-bottom: 1px dashed #cbd5e1; }
        
        .btn-group { display: flex; gap: 10px; }
        .btn-group button { padding: 8px; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginDiv">
        <h2>Login T√©cnico</h2>
        <input type="password" id="senha" placeholder="Digite a senha (1234)">
        <button onclick="login()">Acessar Painel</button>
    </div>

    <div id="adminDiv" class="hidden">
        <h2>Painel de Controle</h2>
        <input id="cliente" placeholder="Nome do Cliente">
        <input id="aparelho" placeholder="Modelo do Ar-Condicionado">
        <button onclick="addAparelho()">Cadastrar Novo Aparelho</button>

        <h3>Aparelhos Cadastrados</h3>
        <div id="lista">Carregando...</div>

        <button class="secondary" onclick="logout()">Sair do Sistema</button>
    </div>

    <div id="clienteDiv" class="hidden">
        <h2>Hist√≥rico de Manuten√ß√µes</h2>
        <div id="histHeader"></div>
        <div id="histLista"></div>

        <h3 style="margin-top:20px">Registrar Nova Atividade</h3>
        <textarea id="descManut" rows="3" placeholder="O que foi feito no aparelho?"></textarea>
        <button onclick="clienteAddManut()">Salvar Registro</button>
        
        <button class="secondary" onclick="voltarAdmin()">‚Üê Voltar ao Painel</button>
    </div>
</div>

<script>
    const SENHA_MESTRA = "1234";

    // --- L√ìGICA DE LOGIN ---
    function login() {
        const s = document.getElementById("senha").value;
        if(s === SENHA_MESTRA){
            document.getElementById("loginDiv").classList.add("hidden");
            document.getElementById("adminDiv").classList.remove("hidden");
            listarAparelhos();
        } else {
            alert("Senha incorreta!");
        }
    }

    function logout() { location.reload(); }

    function voltarAdmin() {
        document.getElementById("clienteDiv").classList.add("hidden");
        document.getElementById("adminDiv").classList.remove("hidden");
        listarAparelhos();
    }

    // --- GEST√ÉO DE DADOS ---
    function getDados() {
        return JSON.parse(localStorage.getItem("aparelhos") || "[]");
    }

    function salvarDados(dados) {
        localStorage.setItem("aparelhos", JSON.stringify(dados));
    }

    // --- FUN√á√ïES T√âCNICAS ---
    function addAparelho() {
        const cliente = document.getElementById("cliente").value.trim();
        const aparelho = document.getElementById("aparelho").value.trim();
        
        if(!cliente || !aparelho) return alert("Preencha todos os campos!");

        const novosDados = getDados();
        novosDados.push({
            id: "ID-" + Math.floor(Math.random() * 10000),
            cliente,
            aparelho,
            manutencoes: []
        });

        salvarDados(novosDados);
        document.getElementById("cliente").value = "";
        document.getElementById("aparelho").value = "";
        listarAparelhos();
    }

    function listarAparelhos() {
        const lista = document.getElementById("lista");
        const aparelhos = getDados();
        
        if(aparelhos.length === 0) {
            lista.innerHTML = "<p>Nenhum registro encontrado.</p>";
            return;
        }

        lista.innerHTML = "";
        aparelhos.forEach(a => {
            const div = document.createElement("div");
            div.className = "aparelho-card";
            div.innerHTML = `
                <strong>üë§ Cliente:</strong> ${a.cliente}<br>
                <strong>‚ùÑÔ∏è Aparelho:</strong> ${a.aparelho}
                <div class="btn-group">
                    <button onclick="verDetalhes('${a.id}')">Gerenciar / Ver Hist√≥rico</button>
                    <button style="background:#dc2626" onclick="deletarAparelho('${a.id}')">Excluir</button>
                </div>
            `;
            lista.appendChild(div);
        });
    }

    function deletarAparelho(id) {
        if(confirm("Deseja excluir este registro permanentemente?")) {
            const dados = getDados().filter(a => a.id !== id);
            salvarDados(dados);
            listarAparelhos();
        }
    }

    // --- √ÅREA DE DETALHES (CLIENTE/T√âCNICO) ---
    function verDetalhes(id) {
        document.getElementById("adminDiv").classList.add("hidden");
        document.getElementById("clienteDiv").classList.remove("hidden");
        document.getElementById("clienteDiv").dataset.id = id;
        atualizarVisualizacaoHistorico(id);
    }

    function clienteAddManut() {
        const desc = document.getElementById("descManut").value.trim();
        const id = document.getElementById("clienteDiv").dataset.id;
        
        if(!desc) return alert("Descreva a manuten√ß√£o realizada.");

        const dados = getDados();
        const index = dados.findIndex(a => a.id === id);
        
        if(index !== -1) {
            dados[index].manutencoes.unshift({ // Adiciona no in√≠cio da lista
                data: new Date().toLocaleDateString('pt-BR'),
                desc: desc
            });
            salvarDados(dados);
            document.getElementById("descManut").value = "";
            atualizarVisualizacaoHistorico(id);
        }
    }

    function atualizarVisualizacaoHistorico(id) {
        const aparelhos = getDados();
        const a = aparelhos.find(x => x.id === id);
        const header = document.getElementById("histHeader");
        const lista = document.getElementById("histLista");

        if(!a) return;

        header.innerHTML = `<h3>${a.cliente} <small>(${a.aparelho})</small></h3>`;
        
        if(a.manutencoes.length === 0) {
            lista.innerHTML = "<p>Sem hist√≥rico de manuten√ß√£o.</p>";
        } else {
            lista.innerHTML = a.manutencoes.map(m => `
                <div class="manutencao-item">
                    <strong>üìÖ ${m.data}:</strong> ${m.desc}
                </div>
            `).join('');
        }
    }

    // Inicializa√ß√£o por URL (ex: index.html?id=ID-123)
    window.onload = function() {
        const params = new URLSearchParams(location.search);
        const id = params.get("id");
        if(id) verDetalhes(id);
    };
</script>

</body>
</html>
