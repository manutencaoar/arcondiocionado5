<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Manuten√ß√£o Ar-Condicionado</title>
<style>
body{font-family:Arial;padding:20px;}
.hidden{display:none;}
input,button{display:block;margin:10px 0;padding:8px;width:100%;}
div.aparelho{border:1px solid #ccc;padding:10px;margin:10px 0;}
</style>
</head>
<body>

<div id="loginDiv">
<h2>Login T√©cnico</h2>
<input type="password" id="senha" placeholder="Senha">
<button onclick="login()">Entrar</button>
</div>

<div id="adminDiv" class="hidden">
<h2>Painel T√©cnico</h2>
<input id="cliente" placeholder="Nome do Cliente">
<input id="aparelho" placeholder="Descri√ß√£o do Aparelho">
<button onclick="addAparelho()">Adicionar Aparelho</button>

<h3>Lista de Aparelhos</h3>
<div id="lista"></div>

<button onclick="logout()">Sair</button>
</div>

<div id="clienteDiv" class="hidden">
<h2>Hist√≥rico do Aparelho</h2>
<div id="hist"></div>
</div>

<script>
const senhaCorreta = "1234";

// Login
function login(){
  const s = document.getElementById("senha").value;
  if(s===senhaCorreta){
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("adminDiv").classList.remove("hidden");
    listarAparelhos();
  } else alert("Senha incorreta");
}
function logout(){ location.reload(); }

// Adicionar Aparelho
function addAparelho(){
  const cliente = document.getElementById("cliente").value.trim();
  const aparelho = document.getElementById("aparelho").value.trim();
  if(!cliente || !aparelho){ alert("Preencha todos os campos"); return; }
  const id = "ap"+Date.now();
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
  aparelhos.push({id,cliente,aparelho,manutencoes:[]});
  localStorage.setItem("aparelhos",JSON.stringify(aparelhos));
  document.getElementById("cliente").value="";
  document.getElementById("aparelho").value="";
  listarAparelhos();
}

// Listar Aparelhos
function listarAparelhos(){
  const lista = document.getElementById("lista");
  lista.innerHTML="";
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
  if(aparelhos.length===0){ lista.innerHTML="Nenhum aparelho cadastrado."; return; }
  aparelhos.forEach(a=>{
    const div = document.createElement("div");
    div.className = "aparelho";
    div.innerHTML = `<strong>${a.cliente}</strong> - ${a.aparelho}<br>
    <button onclick="adicionarManut('${a.id}')">Adicionar Manuten√ß√£o</button>
    <button onclick="gerarQR('${a.id}')">Ver Cliente</button>`;
    lista.appendChild(div);
  });
}

// Adicionar Manuten√ß√£o
function adicionarManut(id){
  const desc = prompt("Descri√ß√£o da manuten√ß√£o:");
  if(!desc) return;
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos"));
  const aparelho = aparelhos.find(a=>a.id===id);
  aparelho.manutencoes.push({data:new Date().toLocaleDateString(),desc});
  localStorage.setItem("aparelhos",JSON.stringify(aparelhos));
  listarAparelhos();
}

// Gerar QR / link para cliente
function gerarQR(id){
  alert("Link para cliente: "+location.origin+location.pathname+"?id="+id);
}

// Cliente (abrir p√°gina com ?id=)
window.onload = function(){
  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  if(id){
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("adminDiv").classList.add("hidden");
    document.getElementById("clienteDiv").classList.remove("hidden");
    const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
    const a = aparelhos.find(x=>x.id===id);
    if(!a){ document.getElementById("hist").innerText="Aparelho n√£o encontrado."; return; }
    const hist = document.getElementById("hist");
    hist.innerHTML = `<strong>${a.cliente}</strong> - ${a.aparelho}<hr>`;
    if(a.manutencoes.length===0){ hist.innerHTML+="Nenhuma manuten√ß√£o registrada."; return; }
    a.manutencoes.forEach(m=>{
      hist.innerHTML+=`üìÖ ${m.data}: ${m.desc}<br>`;
    });
  }
}
</script>
</body>
</html>
