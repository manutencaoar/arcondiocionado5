<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>ManutenÃ§Ã£o Ar-Condicionado</title>
<style>
body{font-family:Arial;padding:20px;}
.hidden{display:none;}
input,button{display:block;margin:10px 0;padding:8px;width:100%;}
</style>
</head>
<body>

<div id="loginDiv">
<h2>Login TÃ©cnico</h2>
<input type="password" id="senha" placeholder="Senha">
<button onclick="login()">Entrar</button>
</div>

<div id="adminDiv" class="hidden">
<h2>Painel TÃ©cnico</h2>
<input id="cliente" placeholder="Nome do Cliente">
<input id="aparelho" placeholder="DescriÃ§Ã£o do Aparelho">
<button onclick="addAparelho()">Adicionar Aparelho</button>

<h3>Lista de Aparelhos</h3>
<div id="lista"></div>

<button onclick="logout()">Sair</button>
</div>

<div id="clienteDiv" class="hidden">
<h2>HistÃ³rico do Aparelho</h2>
<div id="hist"></div>
</div>

<script>
const senhaCorreta = "1234";

// Login
function login(){
  const s = document.getElementById("senha").value;
  if(s===senhaCorreta){
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("adminDiv").classList.remove("hidden");
    listarAparelhos();
  } else alert("Senha incorreta");
}
function logout(){ location.reload(); }

// Adicionar Aparelho
function addAparelho(){
  const cliente = document.getElementById("cliente").value;
  const aparelho = document.getElementById("aparelho").value;
  if(!cliente || !aparelho) return;
  const id = "ap"+Date.now();
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
  aparelhos.push({id,cliente,aparelho,manutencoes:[]});
  localStorage.setItem("aparelhos",JSON.stringify(aparelhos));
  document.getElementById("cliente").value="";
  document.getElementById("aparelho").value="";
  listarAparelhos();
}

// Listar Aparelhos
function listarAparelhos(){
  const lista = document.getElementById("lista");
  lista.innerHTML="";
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
  aparelhos.forEach(a=>{
    const div = document.createElement("div");
    div.innerHTML = `<strong>${a.cliente}</strong> - ${a.aparelho}
    <button onclick="adicionarManut('${a.id}')">Adicionar ManutenÃ§Ã£o</button>
    <button onclick="gerarQR('${a.id}')">QR</button>`;
    lista.appendChild(div);
  });
}

// Adicionar ManutenÃ§Ã£o
function adicionarManut(id){
  const desc = prompt("DescriÃ§Ã£o da manutenÃ§Ã£o:");
  if(!desc) return;
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos"));
  const aparelho = aparelhos.find(a=>a.id===id);
  aparelho.manutencoes.push({data:new Date().toLocaleDateString(),desc});
  localStorage.setItem("aparelhos",JSON.stringify(aparelhos));
  listarAparelhos();
}

// Gerar QR (mostra link com id)
function gerarQR(id){
  alert("QR Link: "+location.href+"?id="+id);
}

// Cliente (ao abrir pÃ¡gina com ?id=)
window.onload = function(){
  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  if(id){
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("adminDiv").classList.add("hidden");
    document.getElementById("clienteDiv").classList.remove("hidden");
    const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
    const a = aparelhos.find(x=>x.id===id);
    if(!a) return;
    const hist = document.getElementById("hist");
    hist.innerHTML = `<strong>${a.cliente}</strong> - ${a.aparelho}<hr>`;
    a.manutencoes.forEach(m=>{
      hist.innerHTML+=`ðŸ“… ${m.data}: ${m.desc}<br>`;
    });
  }
}
</script>
</body>
</html>
