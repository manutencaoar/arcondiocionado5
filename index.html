<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Manuten√ß√£o Ar-Condicionado</title>
<style>
body { font-family: Arial; padding: 20px; }
.hidden { display: none; }
input, button, textarea { display: block; margin: 10px 0; padding: 8px; width: 100%; }
div.aparelho { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
textarea { resize: none; }
</style>
</head>
<body>

<!-- LOGIN T√âCNICO -->
<div id="loginDiv">
  <h2>Login T√©cnico</h2>
  <input type="password" id="senha" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<!-- PAINEL T√âCNICO -->
<div id="adminDiv" class="hidden">
  <h2>Painel T√©cnico</h2>
  <input id="cliente" placeholder="Nome do Cliente">
  <input id="aparelho" placeholder="Descri√ß√£o do Aparelho">
  <button onclick="addAparelho()">Adicionar Aparelho</button>

  <h3>Lista de Aparelhos</h3>
  <div id="lista">Nenhum aparelho cadastrado.</div>

  <button onclick="logout()">Sair</button>
</div>

<!-- √ÅREA DO CLIENTE -->
<div id="clienteDiv" class="hidden">
  <h2>Hist√≥rico do Aparelho</h2>
  <div id="hist"></div>

  <h3>Adicionar Manuten√ß√£o</h3>
  <textarea id="descManut" placeholder="Descri√ß√£o da manuten√ß√£o"></textarea>
  <button onclick="clienteAddManut()">Registrar Manuten√ß√£o</button>
</div>

<script>
const senhaCorreta = "1234";

// LOGIN T√âCNICO
function login() {
  const s = document.getElementById("senha").value;
  if(s === senhaCorreta){
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("adminDiv").classList.remove("hidden");
    listarAparelhos();
  } else alert("Senha incorreta");
}

// LOGOUT
function logout() { location.reload(); }

// ADICIONAR APARELHO
function addAparelho() {
  const cliente = document.getElementById("cliente").value.trim();
  const aparelho = document.getElementById("aparelho").value.trim();
  if(!cliente || !aparelho){ alert("Preencha todos os campos"); return; }
  const id = "ap" + Date.now();
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
  aparelhos.push({id, cliente, aparelho, manutencoes: []});
  localStorage.setItem("aparelhos", JSON.stringify(aparelhos));
  document.getElementById("cliente").value = "";
  document.getElementById("aparelho").value = "";
  listarAparelhos();
}

// LISTAR APARELHOS
function listarAparelhos() {
  const lista = document.getElementById("lista");
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
  if(aparelhos.length === 0) { lista.innerHTML = "Nenhum aparelho cadastrado."; return; }
  lista.innerHTML = "";
  aparelhos.forEach(a => {
    const div = document.createElement("div");
    div.className = "aparelho";
    div.innerHTML = `<strong>${a.cliente}</strong> - ${a.aparelho}<br>
      <button onclick="adicionarManut('${a.id}')">Adicionar Manuten√ß√£o</button>
      <button onclick="verCliente('${a.id}')">Ver √Årea do Cliente</button>`;
    lista.appendChild(div);
  });
}

// ADICIONAR MANUTEN√á√ÉO (T√âCNICO)
function adicionarManut(id) {
  const desc = prompt("Descri√ß√£o da manuten√ß√£o:");
  if(!desc) return;
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos"));
  const aparelho = aparelhos.find(a => a.id === id);
  aparelho.manutencoes.push({data: new Date().toLocaleDateString(), desc});
  localStorage.setItem("aparelhos", JSON.stringify(aparelhos));
  listarAparelhos();
}

// ABRIR √ÅREA DO CLIENTE
function verCliente(id) {
  document.getElementById("adminDiv").classList.add("hidden");
  document.getElementById("clienteDiv").classList.remove("hidden");
  mostrarHistoricoCliente(id);
}

// CLIENTE ADICIONA MANUTEN√á√ÉO
function clienteAddManut() {
  const desc = document.getElementById("descManut").value.trim();
  if(!desc){ alert("Digite a descri√ß√£o da manuten√ß√£o"); return; }
  const id = document.getElementById("clienteDiv").dataset.id;
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
  const aparelho = aparelhos.find(a => a.id === id);
  if(!aparelho){ alert("Aparelho n√£o encontrado"); return; }
  aparelho.manutencoes.push({data: new Date().toLocaleDateString(), desc});
  localStorage.setItem("aparelhos", JSON.stringify(aparelhos));
  document.getElementById("descManut").value = "";
  mostrarHistoricoCliente(id);
}

// MOSTRAR HIST√ìRICO CLIENTE
function mostrarHistoricoCliente(id) {
  const aparelhos = JSON.parse(localStorage.getItem("aparelhos")||"[]");
  const a = aparelhos.find(x => x.id === id);
  if(!a) { document.getElementById("hist").innerText = "Aparelho n√£o encontrado."; return; }
  document.getElementById("clienteDiv").dataset.id = id;
  const hist = document.getElementById("hist");
  hist.innerHTML = `<strong>${a.cliente}</strong> - ${a.aparelho}<hr>`;
  if(a.manutencoes.length === 0) { hist.innerHTML += "Nenhuma manuten√ß√£o registrada."; return; }
  a.manutencoes.forEach(m => {
    hist.innerHTML += `üìÖ ${m.data}: ${m.desc}<br>`;
  });
}

// CARREGAR √ÅREA DO CLIENTE VIA URL
window.onload = function() {
  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  if(id){
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("adminDiv").classList.add("hidden");
    doc
